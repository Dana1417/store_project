{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>سلة المشتريات</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body {font-family:'Tajawal',sans-serif;margin:0;background:#f5f7fb;color:#333;}
    .wrap {padding:30px;max-width:1100px;margin:auto;}
    h2 {text-align:center;margin:0 0 25px;color:#ff9800;font-size:26px;}

    .card {background:#fff;border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,.06);padding:25px;margin-bottom:20px;}

    .table-wrapper {overflow-x:auto;}
    .cart-table {width:100%;border-collapse:collapse;background:#fff;}
    .cart-table thead {background:#ffecd2;}
    .cart-table th, .cart-table td {padding:12px;text-align:center;border-bottom:1px solid #eee;}
    .cart-table img {height:60px;border-radius:8px;}

    /* أزرار التحكم بالكمية */
    .qty-control {display:flex;align-items:center;justify-content:center;gap:6px;}
    .qty-btn {
      background:#ff9800;border:0;color:#fff;font-size:14px;
      padding:6px 10px;border-radius:50%;cursor:pointer;font-weight:700;
      width:32px;height:32px;display:flex;align-items:center;justify-content:center;
      transition:.2s;
    }
    .qty-btn:hover {background:#e68900;}

    /* Responsive */
    @media(max-width:768px){
      .cart-table, .cart-table thead, .cart-table tbody, .cart-table th, .cart-table td, .cart-table tr {display:block;width:100%;}
      .cart-table thead {display:none;}
      .cart-table tr {margin-bottom:16px;border:1px solid #ddd;border-radius:12px;padding:12px;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.05);}
      .cart-table td {border:none;text-align:right;display:flex;justify-content:space-between;padding:8px 0;}
      .cart-table td::before {content:attr(data-label);font-weight:600;color:#555;}
    }

    .summary {background:#fff;padding:20px;border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.06);}
    .summary h3 {margin:0 0 15px;font-size:20px;color:#2c3e50;}
    .summary-row {display:flex;justify-content:space-between;margin:8px 0;}
    .summary-row.total {font-weight:800;font-size:18px;color:#2c3e50;}

    .actions {display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-top:20px;}
    .btn {padding:10px 18px;border-radius:10px;text-decoration:none;font-weight:600;border:0;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:.2s;}
    .btn.gray {background:#607d8b;color:#fff;}
    .btn.orange {background:#ff9800;color:#fff;}
    .btn.green {background:#4caf50;color:#fff;}
    .btn:hover {filter:brightness(0.9);}
    .rm-btn {background:transparent;border:0;color:#e53935;font-size:18px;cursor:pointer;}
    .rm-btn:hover {color:#b71c1c;}

    .empty {text-align:center;font-size:16px;color:#888;margin:20px 0;}
  </style>
</head>
<body>

  {% include "header.html" %}

  <div class="wrap">
    <h2><i class="fa-solid fa-cart-shopping"></i> سلة المشتريات</h2>

    <div class="card">
      {% if items %}
        <div class="table-wrapper">
          <table class="cart-table">
            <thead>
              <tr>
                <th>الصورة</th>
                <th>المنتج / الدورة</th>
                <th>السعر</th>
                <th>الكمية</th>
                <th>الإجمالي</th>
                <th>إزالة</th>
              </tr>
            </thead>
            <tbody>
              {% for it in items %}
              <tr>
                <td data-label="الصورة">
                  {% if it.product.image %}
                    <img src="{{ it.product.image.url }}" alt="{{ it.product.name }}">
                  {% else %}—{% endif %}
                </td>
                <td data-label="المنتج">{{ it.product.name }}</td>
                <td data-label="السعر">{{ it.product.price }} ريال</td>
                <td data-label="الكمية">
                  <div class="qty-control">
                    <form method="post" action="{% url 'store:update_cart' it.product.id %}">
                      {% csrf_token %}
                      <input type="hidden" name="action" value="decrease">
                      <button class="qty-btn"><i class="fa-solid fa-minus"></i></button>
                    </form>
                    <span>{{ it.quantity }}</span>
                    <form method="post" action="{% url 'store:update_cart' it.product.id %}">
                      {% csrf_token %}
                      <input type="hidden" name="action" value="increase">
                      <button class="qty-btn"><i class="fa-solid fa-plus"></i></button>
                    </form>
                  </div>
                </td>
                <td data-label="الإجمالي">{{ it.subtotal }} ريال</td>
                <td data-label="إزالة">
                  <form method="post" action="{% url 'store:remove_from_cart' it.product.id %}">
                    {% csrf_token %}
                    <button type="submit" class="rm-btn" title="إزالة"><i class="fa-solid fa-trash"></i></button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="summary">
          <h3>ملخص الطلب</h3>
          <div class="summary-row"><span>المجموع الفرعي:</span><span>{{ total }} ريال</span></div>
          <div class="summary-row"><span>الضريبة (15%):</span><span>{{ tax }} ريال</span></div>
          <div class="summary-row total"><span>الإجمالي الكلي:</span><span>{{ grand_total }} ريال</span></div>
        </div>

        <div class="actions">
          <a href="{% url 'store:product_list' %}" class="btn gray"><i class="fa-solid fa-arrow-right"></i> متابعة التسوق</a>
          <form method="post" action="{% url 'store:checkout' %}">
            {% csrf_token %}
            <button type="submit" class="btn green"><i class="fa-solid fa-credit-card"></i> إتمام الحجز / الدفع</button>
          </form>
        </div>

      {% else %}
        <p class="empty">🚫 لا توجد عناصر في السلة.</p>
        <div class="actions">
          <a href="{% url 'store:product_list' %}" class="btn orange"><i class="fa-solid fa-store"></i> ابدأ التسوق</a>
        </div>
      {% endif %}
    </div>
  </div>

  {% include "footer.html" %}
</body>
</html>
