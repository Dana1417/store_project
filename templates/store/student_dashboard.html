{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>لوحة الطالب</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: "Tajawal", system-ui, -apple-system, Arial, sans-serif; margin:0; padding:0; background:#f9f9f9; color:#333; }
    .page-padding { padding-top: 90px; }
    .dashboard-container { max-width: 960px; margin: 0 auto 60px; padding: 24px; background:#fff; border-radius:16px; box-shadow:0 6px 16px rgba(0,0,0,.06); }

    .headline { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:16px; }
    h1 { color:#2c3e50; font-size:26px; margin:0; }
    .actions a { text-decoration:none; padding:8px 14px; border-radius:10px; font-weight:600; }
    .actions a.logout { background:#fbe9e7; color:#d32f2f; }

    .kpis { display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:12px; margin:18px 0 24px; }
    .kpi { background:#fffaf2; border:1px solid #ffe0b2; border-radius:12px; padding:14px; text-align:center; }
    .kpi b { color:#ff6f00; font-size:14px; display:block; margin-bottom:6px; }
    .kpi .num { font-size:22px; font-weight:800; color:#2c3e50; }

    .section-title { margin:18px 0 10px; font-size:20px; font-weight:700; color:#333; }
    .muted { color:#666; font-size:14px; }
    .empty { padding:16px; border:1px dashed #ccc; border-radius:12px; background:#fff; color:#777; text-align:center; }

    .course-card, .list-card { border:1px solid #e0e0e0; border-radius:12px; padding:16px; margin-bottom:12px; background:#fdfdfd; }
    .course-card__head { display:flex; gap:10px; align-items:center; justify-content:space-between; }
    .course-title { margin:0; font-size:18px; color:#1976d2; font-weight:700; }

    .btn-ghost { text-decoration:none; padding:8px 12px; border-radius:10px; border:1px solid #cfd8dc; background:#fff; color:#37474f; font-weight:600; }
    .btn-ghost:hover { background:#f5f5f5; }

    .list-cards { list-style:none; padding:0; margin:0; }
    .list-card { display:flex; align-items:center; justify-content:space-between; gap:12px; }

    @media (max-width: 768px) {
      .dashboard-container{padding:18px;}
      h1{font-size:22px;}
      .course-card__head{flex-direction:column; align-items:flex-start;}
      .list-card{flex-direction:column; align-items:flex-start;}
    }
  </style>
</head>
<body>

  {% include "header.html" %}

  <main class="page-padding">
    <section class="dashboard-container">

      <!-- العنوان -->
      <div class="headline">
        <h1>مرحبًا، {{ student.user.get_full_name|default:student.user.username }}</h1>
        <div class="actions">
          <a class="logout" href="/logout/">تسجيل خروج</a>
        </div>
      </div>

      <!-- مؤشرات سريعة -->
      <div class="kpis">
        <div class="kpi"><b>الدورات المسجّلة</b><div class="num">{{ enroll_count }}</div></div>
        <div class="kpi"><b>نتائج الاختبارات</b><div class="num">{{ exam_count }}</div></div>
        <div class="kpi"><b>الشهادات</b><div class="num">{{ cert_count }}</div></div>
        <div class="kpi"><b>المراجع المتاحة</b><div class="num">{{ res_count }}</div></div>
      </div>

      <!-- ===== الدورات المسجّلة ===== -->
      <h3 class="section-title">الدورات المسجّلة</h3>
      {% if enrollments %}
        {% for e in enrollments %}
          <article class="course-card">
            <div class="course-card__head">
              <!-- نعتمد على __str__ للموديل (يرجع العنوان) -->
              <h4 class="course-title">📘 {{ e.course }}</h4>

              {% with tl=e.course.teams_link %}
                {% if tl %}
                  <a class="btn-ghost" href="{{ tl }}" target="_blank" rel="noopener noreferrer">دخول الدورة على Teams</a>
                {% else %}
                  <span class="muted">لا يوجد رابط تيمز</span>
                {% endif %}
              {% endwith %}
            </div>

            <div class="muted">
              انضمام: {{ e.joined_at|date:"d-m-Y" }}
              {% if e.course.start_date or e.course.end_date %}
                — المدة: {{ e.course.start_date|date:"d-m-Y" }} إلى {{ e.course.end_date|date:"d-m-Y" }}
              {% endif %}
            </div>
          </article>
        {% endfor %}
      {% else %}
        <div class="empty">لا توجد دورات مسجّلة حتى الآن.</div>
      {% endif %}

      <!-- ===== شهاداتي ===== -->
      <h3 class="section-title">شهاداتي</h3>
      {% if certs %}
        <ul class="list-cards">
          {% for c in certs %}
            <li class="list-card">
              <div>
                🎓 <b>{{ c.course }}</b>
                <small class="muted">— {{ c.issued_at|date:"d-m-Y" }}</small>
              </div>
              {% if c.file_url %}
                <a class="btn-ghost" href="{{ c.file_url }}" target="_blank" rel="noopener">عرض الشهادة</a>
              {% else %}
                <span class="muted">لا يوجد ملف شهادة</span>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="empty">لا توجد شهادات حتى الآن.</div>
      {% endif %}

      <!-- ===== المراجع المتاحة ===== -->
      <h3 class="section-title">المراجع المتاحة</h3>
      {% if resources %}
        <ul class="list-cards">
          {% for r in resources %}
            <li class="list-card">
              <div>
                📄 <b>{{ r.title }}</b>
                <small class="muted">— {{ r.course|default:"عام" }}</small>
              </div>
              <a class="btn-ghost" href="{{ r.file_url }}" target="_blank" rel="noopener">فتح المرجع</a>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="empty">لا توجد مراجع حتى الآن.</div>
      {% endif %}

    </section>
  </main>

  {% include "footer.html" %}
</body>
</html>
