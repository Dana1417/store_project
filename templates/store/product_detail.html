{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{ product.name }} - التفاصيل</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Tajawal',sans-serif; margin:0; background:#fffaf0; color:#333; }
    .wrap { max-width: 980px; margin: 28px auto 60px; padding: 0 16px; }
    .card { background:#fff; border:1px solid #eee; border-radius:16px; box-shadow:0 6px 22px rgba(0,0,0,.06); padding:24px; }
    .grid { display:grid; grid-template-columns: 420px 1fr; gap:24px; }
    @media (max-width: 900px){ .grid{ grid-template-columns: 1fr; } }
    .media { border-radius:12px; overflow:hidden; border:1px solid #eee; background:#fafafa; height: 320px; display:grid; place-items:center; }
    .media img { width:100%; height:100%; object-fit:cover; display:block; }
    .title { margin:0 0 8px; color:#e67e22; text-align:center; font-size:30px; }
    .price { font-weight:800; color:#e67e22; margin:6px 0 14px; text-align:center; }
    .badge { display:inline-block; padding:4px 10px; border-radius:999px; font-size:12px; font-weight:800; }
    .ok { background:#e9f7ef; color:#1e7e34; border:1px solid #c7eed8; }
    .no { background:#fdecea; color:#a71d2a; border:1px solid #f5c6cb; }
    .desc { line-height:1.9; white-space:pre-wrap; }
    .muted { color:#777; }
    .actions { display:flex; gap:10px; margin-top:16px; flex-wrap:wrap; justify-content:center; align-items:center; }
    .btn { background:#f39c12; color:#fff; text-decoration:none; padding:10px 16px; border-radius:9999px; font-weight:800; display:inline-block; border:0; cursor:pointer; }
    .btn:hover { background:#e67e22; }
    .btn.gray { background:#999; }
    .btn.gray:hover { background:#7d7d7d; }

    /* رسائل */
    .messages{max-width:980px;margin:12px auto 0;padding:0 16px}
    .msg{padding:10px 12px;border-radius:10px;margin-bottom:8px;border:1px solid transparent;line-height:1.5}
    .msg.success{background:#e9f7ef;color:#1e7e34;border-color:#c7eed8}
    .msg.error{background:#fdecea;color:#a71d2a;border-color:#f5c6cb}
  </style>
</head>
<body>

  {% include 'header.html' %}

  <!-- عرض رسائل Django -->
  <div class="messages">
    {% if messages %}
      {% for m in messages %}
        <div class="msg {% if m.tags and 'success' in m.tags %}success{% elif m.tags and 'error' in m.tags %}error{% endif %}">
          {{ m }}
        </div>
      {% endfor %}
    {% endif %}
  </div>

  <div class="wrap">
    <div class="card">
      <div class="title">{{ product.name }}</div>
      <div class="price">{{ product.price }} ريال</div>
      <div class="meta" style="text-align:center;margin-bottom:12px;">
        {% if product.available %}
          <span class="badge ok">متاح</span>
        {% else %}
          <span class="badge no">غير متاح</span>
        {% endif %}
      </div>

      <div class="grid">
        <div class="media">
          {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}">
          {% else %}
            <div style="color:#bbb;font-weight:700;">لا توجد صورة</div>
          {% endif %}
        </div>

        <div>
          <h3 style="margin:0 0 8px;">الوصف</h3>
          <div class="desc">
            {% if product.description %}
              {{ product.description|linebreaksbr }}
            {% else %}
              <span class="muted">لا يوجد وصف لهذا المنتج حالياً.</span>
            {% endif %}
          </div>

          <div class="actions">
            {% if product.available %}
              <!-- زر احجز الآن -->
              <a href="{% url 'booking' %}?product_id={{ product.id }}" class="btn">احجز الآن</a>

              <!-- زر أضف للسلة -->
              <form method="post" action="{% url 'add_to_cart' product.id %}" style="margin:0; display:inline;">
                {% csrf_token %}
                <input type="hidden" name="quantity" value="1">
                <button type="submit" class="btn gray">أضف للسلة</button>
              </form>

              <!-- زر تفاصيل الحجز -->
              <a href="{% url 'booking' %}" class="btn gray">تفاصيل الحجز</a>
            {% else %}
              <a class="btn" style="background:#ddd;color:#888;pointer-events:none;">غير متاح للحجز</a>
            {% endif %}

            <!-- زر الرجوع -->
            <a href="{% url 'product_list' %}" class="btn gray">رجوع للمنتجات</a>
          </div>

        </div>
      </div>
    </div>
  </div>

  {% include 'footer.html' %}

</body>
</html>
