{% extends "students/base.html" %}
{% load static %}

{% block title %}📘 {{ course.title }}{% endblock %}

{% block content %}
<main dir="rtl" class="wrapper" style="max-width:1150px;margin:0 auto;padding:28px 16px;">

  <!-- العنوان + زر العودة -->
  <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:20px;">
    <h1 style="margin:0;font-size:26px;color:#1f2937;display:flex;align-items:center;gap:8px;">
      📖 {{ course.title }}
    </h1>
    <a href="{% url 'students:dashboard' %}"
       style="text-decoration:none;background:#f3f4f6;border:1px solid #e5e7eb;border-radius:10px;padding:8px 14px;font-size:14px;">
      ⬅️ العودة إلى دوراتي
    </a>
  </div>

  <!-- صورة الغلاف -->
  {% if course.cover_image_url %}
    <div style="margin-bottom:20px;">
      <img src="{{ course.cover_image_url }}" alt="غلاف {{ course.title }}"
           style="width:100%;max-height:320px;object-fit:cover;border-radius:14px;border:1px solid #e5e7eb;">
    </div>
  {% endif %}

  <!-- تخطيط: عمودين -->
  <div style="display:grid;grid-template-columns:1fr 320px;gap:20px;align-items:start;">

    <!-- العمود الأساسي -->
    <div style="display:flex;flex-direction:column;gap:16px;">

      <!-- وصف الدورة -->
      <section class="card">
        <h2>📌 وصف الدورة</h2>
        {% if course.description %}
          <p>{{ course.description|linebreaksbr }}</p>
        {% else %}
          <p class="muted">لا يوجد وصف لهذه الدورة.</p>
        {% endif %}
      </section>

      <!-- المحاضرات -->
      <section class="card">
        <h2>🎓 المحاضرات</h2>
        <ul class="list">
          {% for l in lessons %}
            <li class="item">
              <b>#{{ l.order }} — {{ l.title }}</b>
              <div class="muted" style="margin-top:6px">
                {% if l.recording_url %}
                  🎥 <a href="{{ l.recording_url }}" target="_blank">رابط الفيديو</a>
                {% elif l.video_file %}
                  🎥 <a href="{{ l.video_file.url }}" target="_blank">تحميل الفيديو</a>
                {% endif %}
                {% if l.slide_url %}
                  &nbsp;|&nbsp; 📑 <a href="{{ l.slide_url }}" target="_blank">شرائح</a>
                {% elif l.slide_file %}
                  &nbsp;|&nbsp; 📑 <a href="{{ l.slide_file.url }}" target="_blank">تحميل الشرائح</a>
                {% endif %}
              </div>
              {% if l.content %}
                <p style="margin:8px 0 0;color:#444">{{ l.content|linebreaksbr }}</p>
              {% endif %}
            </li>
          {% empty %}
            <li class="muted">لا توجد محاضرات بعد.</li>
          {% endfor %}
        </ul>
      </section>

      <!-- المراجع -->
      <section class="card">
        <h2>📚 المراجع</h2>
        <ul class="list">
          {% for r in resources %}
            <li class="item">
              <b>{{ r.title }}</b>
              {% if r.external_link %}
                — <a href="{{ r.external_link }}" target="_blank">رابط خارجي</a>
              {% endif %}
              {% if r.file %}
                — <a href="{{ r.file.url }}" target="_blank">تحميل</a>
              {% endif %}
              {% if r.get_kind_display %}
                — <span class="muted">{{ r.get_kind_display }}</span>
              {% endif %}
            </li>
          {% empty %}
            <li class="muted">لا توجد مراجع بعد.</li>
          {% endfor %}
        </ul>
      </section>

    </div>

    <!-- العمود الجانبي -->
    <aside class="card">
      <h3>🎯 حالة الوصول</h3>
      {% if enrollment %}
        <div style="color:#065f46;background:#ecfdf5;border:1px solid #a7f3d0;border-radius:10px;padding:8px;margin-bottom:12px;">
          ✅ أنت مسجّل في هذه الدورة
        </div>
      {% else %}
        <div style="color:#7c2d12;background:#fffbeb;border:1px solid #fde68a;border-radius:10px;padding:8px;margin-bottom:12px;">
          ⚠️ غير مسجّل
        </div>
      {% endif %}

      {% if course.teams_link %}
        <a href="{{ course.teams_link }}" target="_blank" rel="noopener noreferrer"
           style="display:block;text-align:center;padding:10px;border-radius:10px;background:#2563eb;color:#fff;font-weight:700;text-decoration:none;margin-bottom:8px;">
          🚀 دخول مباشر (Teams)
        </a>
      {% endif %}

      <hr style="border:none;border-top:1px solid #f1f5f9;margin:12px 0">
      <div class="muted">آخر تحديث: {% now "Y-m-d H:i" %}</div>
    </aside>
  </div>
</main>

<style>
  .card{background:#fff;border:1px solid #e7eef5;border-radius:14px;padding:18px;box-shadow:0 3px 14px rgba(0,0,0,.04)}
  .card h2{margin:0 0 10px;font-size:18px;color:#111827}
  .list{list-style:none;padding:0;margin:0}
  .item{background:#fafafa;border:1px solid #e5e7eb;border-radius:12px;padding:12px;margin-bottom:10px}
  .muted{color:#6b7280;font-size:14px}
</style>
{% endblock %}
